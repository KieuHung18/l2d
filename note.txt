using System;
using System.IO;
using System.Text.Json;
using Spine;

public static class SpineConverter
{
    public static void ConvertBinaryToJson(string binaryPath, string atlasPath, string outputJsonPath)
    {
        if (!File.Exists(binaryPath))
            throw new FileNotFoundException("Binary skeleton not found", binaryPath);
        if (!File.Exists(atlasPath))
            throw new FileNotFoundException("Atlas file not found", atlasPath);

        string folder = Path.GetDirectoryName(binaryPath)!;
        var atlas = new Atlas(atlasPath, new SkiaTextureLoader(folder));
        var loader = new AtlasAttachmentLoader(atlas);
        var binary = new SkeletonBinary(loader);

        SkeletonData data = binary.ReadSkeletonData(binaryPath);

        // Manual lightweight export
        var export = new
        {
            Name = data.Name,
            Bones = data.Bones.Select(b => new { b.Name, b.X, b.Y, b.Rotation, b.ScaleX, b.ScaleY }).ToList(),
            Slots = data.Slots.Select(s => new { s.Name, s.BoneData.Name, s.AttachmentName }).ToList(),
            Animations = data.Animations.Select(a => a.Name).ToList()
        };

        string json = JsonSerializer.Serialize(export, new JsonSerializerOptions { WriteIndented = true });
        File.WriteAllText(outputJsonPath, json);

        Console.WriteLine($"âœ… Skeleton converted to readable JSON: {outputJsonPath}");
    }
}