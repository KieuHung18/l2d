using System;
using System.IO;
using Spine;
using SkiaSharp;

public class SkiaTextureLoader : TextureLoader
{
    private readonly string folder;

    public SkiaTextureLoader(string folderPath)
    {
        folder = folderPath;
    }

    public void Load(AtlasPage page, string path)
    {
        // Spine expects textures to come from the atlas
        if (!path.EndsWith(".png", StringComparison.OrdinalIgnoreCase))
            path += ".png";

        string filePath = Path.Combine(folder, path);
        if (!File.Exists(filePath))
            throw new FileNotFoundException("Texture not found", filePath);

        using var data = SKData.Create(filePath);
        var img = SKImage.FromEncodedData(data);

        page.rendererObject = img;
        page.width = img.Width;
        page.height = img.Height;
    }

    public void Unload(object texture)
    {
        if (texture is SKImage img)
            img.Dispose();
    }
}